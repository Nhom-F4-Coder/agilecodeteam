CREATE DATABASE QUANLIBANHANGDB
ON
(
	NAME="QUANLIBANHANG",
	filename="H:\align\QUANLIBANHANG\QUANLIBANHANG.MDF",
	SIZE=100MB,
	MAXSIZE= 200MB,
	FILEGROWTH=10MB
)
LOG ON
(
	NAME="QUANLIBANHANG_LOG",
	FILENAME = "H:\align\QUANLIBANHANG\QUANLIBANHANG_LOG.LDF",
	SIZE=100MB,
	MAXSIZE= 200MB,
	FILEGROWTH=10MB
)
go
USE  QUANLIBANHANGDB
GO

-- SẢN PHẨM
CREATE TABLE SANPHAM
(
MASANPHAM VARCHAR(10) NOT NULL,
TENSANPHAM NVARCHAR(50) NOT NULL,
SOLUONG INT NOT NULL,
GIA MONEY NOT NULL,
KHUYENMAI INT NOT NULL,
NGAYNHAPKHO DATE NOT NULL,
TINHTRANG NVARCHAR(30) ,
CAUHINH NVARCHAR(100) ,
CONSTRAINT PK_SANPHAM PRIMARY KEY(MASANPHAM)
)
GO

CREATE TABLE KHACHHANG
(
MAKHACHHANG VARCHAR(10) NOT NULL,
--HOKHACHHANG NVARCHAR(7) NOT NULL,
--TENDEMKHACHHANG NVARCHAR(15) NOT NULL,
--TENKHACHHANG NVARCHAR(7) NOT NULL,
HOTENKHACHHANG NVARCHAR(30) NOT NULL,
GIOITINH BIT NOT NULL, -- 0 NỮ 1 NAM
--NGAYSINH DATE NULL,
SODIENTHOAI VARCHAR(13) NOT NULL,
DIACHI NVARCHAR(55) NULL,
--KHACHHANGVIP BIT NOT NULL,
CONSTRAINT PK_KHACHHANG PRIMARY KEY(MAKHACHHANG)
)
GO

CREATE TABLE TAIKHOAN
(
ID int identity (1,1)  NOT NULL,
TAIKHOAN VARCHAR(20) NOT NULL,
MATKHAU VARCHAR(20) NOT NULL,

--HOQUANLI NVARCHAR(7) NOT NULL,
--TENDEMQUANLI NVARCHAR(15) NOT NULL,
--TENQUANLI NVARCHAR(7) NOT NULL,
HOTENQUANLI NVARCHAR(30) NOT NULL,
SODIENTHOAI VARCHAR(13) NOT NULL,
CHUCVU BIT NOT NULL,
CONSTRAINT PK_QUANLI PRIMARY KEY(ID)
)
GO

CREATE TABLE HOADON
(
MAHOADON VARCHAR(15) NOT NULL,
MAKHACHHANG VARCHAR(10) NOT NULL,
ID int identity (1,1)  NOT NULL,
--TRAGOP BIT ,
CONSTRAINT PK_HOADON PRIMARY KEY (MAHOADON), 
CONSTRAINT FK_HOADON_KHACHHANG FOREIGN KEY (MAKHACHHANG) REFERENCES KHACHHANG(MAKHACHHANG),
CONSTRAINT FK_HOADON_TAIKHOAN FOREIGN KEY (ID) REFERENCES TAIKHOAN(ID)
)
GO
CREATE TABLE HOADONCHITIET
(
--MAHOADONCHITIET VARCHAR(15) NOT NULL,
MAHOADON VARCHAR(15) NOT NULL,
MASANPHAM VARCHAR(10) NOT NULL,
SOLUONG INT NOT NULL,
NGAYMUAHANG DATE NOT NULL,
GIA MONEY NOT NULL,
--KHUYENMAI INT ,
TONGTIEN  MONEY NOT NULL,
CONSTRAINT PK_HOADONCHITIET PRIMARY KEY (MAHOADON,MASANPHAM), 
CONSTRAINT FK_MAHOADONCHITIET_SANPHAM FOREIGN KEY (MASANPHAM) REFERENCES SANPHAM(MASANPHAM),
CONSTRAINT FK_MAHOADONCHITIET_HOADON FOREIGN KEY (MAHOADON) REFERENCES HOADON(MAHOADON)
)
GO
CREATE TABLE BAOHANH
(
MABAOHANH VARCHAR(10) PRIMARY KEY NOT NULL,
MASANPHAM VARCHAR(10) NOT NULL,
MAKHACHHANG VARCHAR(10) NOT NULL,
HOTENKHACHHANG NVARCHAR(30) NOT NULL,
SODIENTHOAI VARCHAR(13) NOT NULL,
NGAYMUAHANG DATE NOT NULL,
THOIGIANBAOHANH NVARCHAR(13) NOT NULL, --(NĂM)
NGAYHETBAOHANH DATE NOT NULL, --()
TRANGTHAIBAOHANH BIT NOT NULL,-- 0 CÒN BH, 1 HẾT BH
CONSTRAINT FK_BAOHANH_SANPHAM FOREIGN KEY (MASANPHAM) REFERENCES SANPHAM(MASANPHAM),
CONSTRAINT FK_BAOHANH_KHACHHANG FOREIGN KEY (MAKHACHHANG) REFERENCES KHACHHANG(MAKHACHHANG),
)
GO
select * from TAIKHOAN
insert into TAIKHOAN values ('admin','admin',N'Nguyễn Văn A','0123456789','Admin'),
							('user1','user',N'Nguyễn Văn B','0123456789','User')

select * from BAOHANH
insert into SANPHAM (MASANPHAM,TENSANPHAM,SOLUONG,GIA,KHUYENMAI,NGAYNHAPKHO,TINHTRANG,CAUHINH)
values ('SP01','IPHONE 7',50,7000000,5,'01-01-2010','NEW','XỊN XÒ CON BÒ'),
							('SP02','IPHONE 6',50,6000000,10,'01-01-2008','NEW','XỊN XÒ CON BÒ'),
							('SP03','IPHONE 5',50,5000000,5,'01-01-2008','NEW','XỊN XÒ CON BÒ'),
							('SP04','IPHONE 8',50,9000000,10,'01-01-2018','NEW','XỊN XÒ CON BÒ'),
							('SP05','IPHONE 10',50,1000000,5,'01-01-2019','NEW','XỊN XÒ CON BÒ'),
							('SP06','IPHONE 11',50,10000000,10,'01-01-2020','NEW','XỊN XÒ CON BÒ'),
		('SP07','Iphone 7',20,8000000,30,'2020-10-6','New','Cấu Hình'),
	  ('SP08','Iphone 8',20,20000000,30,'2020-11-6','New','Cấu Hình'),
      ('SP09','Samsung S10+',20,32000000,30,'2020-10-6','New','Cấu Hình'),
      ('SP10','Iphone 11 Pro',20,32000000,30,'2020-1-6','New','Cấu Hình'),
      ('SP11','Oppo A9',20,32000000,30,'2019-10-6','New','Cấu Hình'),
      ('SP12','Iphone 11',20,32000000,30,'2020-8-6','New','Cấu Hình'),
      ('SP13','Iphone 11 Pro Max',20,32000000,30,'2020-9-6','New','Cấu Hình')

insert into KHACHHANG (MAKHACHHANG,HOTENKHACHHANG,GIOITINH,SODIENTHOAI,DIACHI) 
values ('KH0001','Nguyễn Văn A',1,'0123456789','số 1 trịnh văn bô'),
		('KH0002','Nguyễn Thị A',0,'0123456789','số 1 trịnh văn bô'),
		('KH0003','Nguyễn Chí N',1,'0123456789','số 1 trịnh văn bô'),
		('KH0004','Phạm Thị H',0,'0123456789','số 1 trịnh văn bô'),
		('KH0005','Nguyễn Văn D',1,'0123456789','số 1 trịnh văn bô'),
		('KH0006','Nguyễn Văn E',1,'0123456789','số 1 trịnh văn bô'),
		('KH0007','Nguyễn Văn F',1,'0123456789','số 1 trịnh văn bô')

insert into BAOHANH (MABAOHANH,MASANPHAM,MAKHACHHANG,HOTENKHACHHANG,SODIENTHOAI,NGAYMUAHANG,THOIGIANBAOHANH,NGAYHETBAOHANH,TRANGTHAIBAOHANH)
values('OS01','SP01','KH01',N'Nguyễn Văn Đạt','0363402920','2019-2-5','12 Tháng','2020-5-5',1),
	  ('OS02','SP02','KH02',N'Nguyễn Văn Đạt','01938413849','2019-10-5','3 Tháng','2020-5-5',1),
      ('OS03','SP03','KH02',N'Nguyễn Văn Đạt','0363402920','2020-5-5','6 Tháng','2020-5-5',1),
      ('OS04','SP04','KH02',N'Nguyễn Văn Đạt','0363402920','2019-8-5','9 Tháng','2020-5-5',1),
      ('OS05','SP05','KH02',N'Nguyễn Văn Đạt','0363402920','2019-5-5','12 Tháng','2020-5-5',1),
      ('OS06','SP06','KH02',N'Nguyễn Văn Đạt','0363402920','2020-2-5','18 Tháng','2020-5-5',1),
      ('OS07','SP07','KH02',N'Nguyễn Văn Đạt','0363402920','2020-8-5','6 Tháng','2020-5-5',1)


drop view TKDT;
CREATE VIEW TKDT AS
SELECT BAOHANH.MASANPHAM,TENSANPHAM,NGAYMUAHANG,MAKHACHHANG,HOTENKHACHHANG,GIA
FROM BAOHANH INNER JOIN SANPHAM ON BAOHANH.MASANPHAM = SANPHAM.MASANPHAM



